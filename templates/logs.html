{% extends "base.html" %}

{% block content %}
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<div class="log-page-wrapper">
    
    <div class="dashboard-header fade-in">
        <div class="header-content">
            <h6 class="overline">Journaling & Analytics</h6>
            <h1 class="glow-text">Daily Mental & Productivity Log</h1>
            <p>Track your mindset to master your discipline</p>
        </div>
        <div class="live-indicator">
            <span class="dot"></span> System Ready
        </div>
    </div>

    <div class="form-container glass fade-in-delay-1">
        <div class="card-top">
            <h3><i class="fa-solid fa-pen-nib"></i> Log for Today</h3>
            <span class="date-badge">{{ today.strftime('%b %d, %Y') }}</span>
        </div>

        <form method="POST" class="log-form-premium">
            <div class="form-grid">
                <div class="input-group">
                    <label for="mood">Current Mood</label>
                    <div class="select-wrapper">
                        <select id="mood" name="mood">
                            {% set current_mood = log.mood if log else 'Neutral' %}
                            <option value="Good" {% if current_mood == 'Good' %}selected{% endif %}>üòä Good</option>
                            <option value="Neutral" {% if current_mood == 'Neutral' %}selected{% endif %}>üòê Neutral</option>
                            <option value="Low" {% if current_mood == 'Low' %}selected{% endif %}>üòî Low</option>
                        </select>
                    </div>
                </div>

                <div class="input-group">
                    <label for="productivity">Productivity Level</label>
                    <div class="select-wrapper">
                        <select id="productivity" name="productivity">
                            {% set current_prod = log.productivity if log else 3 %}
                            {% for i in range(1, 6) %}
                                <option value="{{ i }}" {% if current_prod == i %}selected{% endif %}>
                                    Level {{ i }} - {{ {1:'Very Low', 2:'Low', 3:'Neutral', 4:'High', 5:'Very High'}[i] }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div class="input-group span-2">
                    <div class="slider-header">
                        <label for="urge_level">Urge Intensity (Relapse Risk)</label>
                        <span id="urge-val" class="value-display">{{ log.urge_level if log else '1' }}</span>
                    </div>
                    <input type="range" id="urge_level" name="urge_level" min="1" max="10" 
                           value="{{ log.urge_level if log else '1' }}" class="premium-slider">
                    <div class="slider-labels">
                        <span>Safe</span>
                        <span>Dangerous</span>
                    </div>
                </div>
            </div>

            <button type="submit" class="save-btn-premium">
                <i class="fa-solid fa-cloud-upload"></i> Sync Daily Log
            </button>
        </form>
    </div>

    <div class="history-section fade-in-delay-2">
        <h3 class="section-title"><i class="fa-solid fa-clock-rotate-left"></i> Past 14 Days Momentum</h3>
        
        {% if past_logs %}
        <div class="table-container glass">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Mood</th>
                        <th>Urge Level</th>
                        <th>Productivity</th>
                    </tr>
                </thead>
                <tbody>
                    {% for log in past_logs %}
                    <tr>
                        <td class="date-col">{{ log.date.strftime('%b %d') }}</td>
                        <td>
                            <span class="mood-tag {{ log.mood.lower() }}">{{ log.mood }}</span>
                        </td>
                        <td>
                            <div class="mini-bar-bg">
                                <div class="mini-bar-fill urge" style="width: {{ log.urge_level * 10 }}%"></div>
                            </div>
                            <span class="table-val">{{ log.urge_level }}/10</span>
                        </td>
                        <td>
                            <div class="mini-bar-bg">
                                <div class="mini-bar-fill prod" style="width: {{ log.productivity * 20 }}%"></div>
                            </div>
                            <span class="table-val">{{ log.productivity }}/5</span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="empty-state glass">
            <p>No historical data available yet. Start logging today!</p>
        </div>
        {% endif %}
    </div>
</div>

<style>
    /* UI CORE & THEME */
    :root {
        --void: #011210;
        --earth: #4a2b03;
        --gold: #c3c908;
        --glass: rgba(10, 25, 23, 0.85);
        --border: rgba(195, 201, 8, 0.15);
    }

    body { background-color: var(--void); color: #e0e0e0; font-family: 'Outfit', sans-serif; }
    .log-page-wrapper { max-width: 900px; margin: 0 auto; padding: 40px 20px; }
    .glass { background: var(--glass); backdrop-filter: blur(15px); border: 1px solid var(--border); border-radius: 24px; }
    .glow-text { text-shadow: 0 0 15px rgba(195, 201, 8, 0.4); color: #fff; }

    /* HEADER */
    .dashboard-header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 40px; padding-bottom: 20px; border-bottom: 1px solid var(--border); }
    .overline { color: var(--gold); text-transform: uppercase; letter-spacing: 2px; font-size: 0.8rem; font-family: 'Rajdhani'; margin: 0; }
    h1 { font-size: 2.2rem; font-weight: 300; margin: 5px 0; }

    .live-indicator { display: flex; align-items: center; gap: 8px; font-size: 0.8rem; color: var(--gold); background: rgba(195, 201, 8, 0.1); padding: 5px 15px; border-radius: 20px; }
    .dot { width: 8px; height: 8px; background: var(--gold); border-radius: 50%; animation: pulse 2s infinite; }

    /* FORM STYLING */
    .form-container { padding: 40px; margin-bottom: 50px; box-shadow: 0 20px 40px rgba(0,0,0,0.4); }
    .card-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
    .card-top h3 { margin: 0; color: var(--gold); font-family: 'Rajdhani'; font-size: 1.5rem; }
    .date-badge { background: var(--earth); padding: 5px 15px; border-radius: 50px; font-size: 0.85rem; border: 1px solid var(--gold); }

    .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
    .span-2 { grid-column: span 2; }
    
    .input-group label { display: block; margin-bottom: 10px; font-size: 0.9rem; color: #aaa; }
    
    /* Premium Select */
    .select-wrapper { position: relative; }
    select {
        width: 100%; background: rgba(0,0,0,0.3); border: 1px solid var(--earth); border-radius: 12px;
        padding: 12px; color: white; font-family: 'Outfit'; outline: none; appearance: none;
    }
    .select-wrapper::after {
        content: '‚ñº'; position: absolute; right: 15px; top: 12px; font-size: 0.7rem; color: var(--gold); pointer-events: none;
    }

    /* Range Slider */
    .slider-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
    .value-display { background: var(--gold); color: var(--void); padding: 2px 12px; border-radius: 6px; font-weight: bold; font-family: 'Rajdhani'; }
    
    .premium-slider {
        -webkit-appearance: none; width: 100%; height: 6px; background: #222; border-radius: 5px; outline: none;
    }
    .premium-slider::-webkit-slider-thumb {
        -webkit-appearance: none; width: 20px; height: 20px; border-radius: 50%; background: var(--gold); cursor: pointer;
        box-shadow: 0 0 10px var(--gold); border: 2px solid white;
    }
    .slider-labels { display: flex; justify-content: space-between; margin-top: 8px; font-size: 0.75rem; color: #555; text-transform: uppercase; }

    /* TABLE STYLING */
    .section-title { font-family: 'Rajdhani'; font-size: 1.4rem; color: #fff; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
    .table-container { overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; text-align: left; }
    th { padding: 20px; font-family: 'Rajdhani'; text-transform: uppercase; letter-spacing: 1px; color: var(--gold); font-size: 0.85rem; border-bottom: 1px solid var(--border); }
    td { padding: 15px 20px; border-bottom: 1px solid rgba(255,255,255,0.02); }
    
    .date-col { font-weight: bold; color: #fff; }
    .mood-tag { padding: 4px 10px; border-radius: 6px; font-size: 0.8rem; }
    .mood-tag.good { background: rgba(0, 255, 100, 0.1); color: #00ff64; border: 1px solid rgba(0, 255, 100, 0.2); }
    .mood-tag.neutral { background: rgba(195, 201, 8, 0.1); color: var(--gold); border: 1px solid var(--border); }
    .mood-tag.low { background: rgba(255, 50, 50, 0.1); color: #ff3232; border: 1px solid rgba(255, 50, 50, 0.2); }

    /* Mini Progress Bars in Table */
    .mini-bar-bg { width: 60px; height: 4px; background: #222; border-radius: 10px; display: inline-block; margin-right: 10px; vertical-align: middle; }
    .mini-bar-fill { height: 100%; border-radius: 10px; }
    .mini-bar-fill.urge { background: #ff3232; box-shadow: 0 0 5px #ff3232; }
    .mini-bar-fill.prod { background: var(--gold); box-shadow: 0 0 5px var(--gold); }
    .table-val { font-size: 0.8rem; font-family: 'Rajdhani'; color: #888; }

    /* SAVE BUTTON */
    .save-btn-premium {
        width: 100%; margin-top: 30px; padding: 18px; border-radius: 15px; border: none;
        background: linear-gradient(90deg, var(--earth), #7a4a06); color: white;
        font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: 0.3s;
        box-shadow: 0 10px 20px rgba(0,0,0,0.3);
    }
    .save-btn-premium:hover { transform: translateY(-3px); box-shadow: 0 15px 30px rgba(0,0,0,0.5); filter: brightness(1.2); }

    /* ANIMATIONS */
    @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .fade-in { animation: fadeInUp 0.6s ease-out forwards; }
    .fade-in-delay-1 { animation: fadeInUp 0.6s ease-out 0.2s forwards; opacity: 0; }
    .fade-in-delay-2 { animation: fadeInUp 0.6s ease-out 0.4s forwards; opacity: 0; }

    @media (max-width: 768px) {
        .form-grid { grid-template-columns: 1fr; }
        .span-2 { grid-column: span 1; }
        .dashboard-header { flex-direction: column; align-items: flex-start; gap: 15px; }
    }
</style>

<script>
    // Real-time Slider Value Update
    const slider = document.getElementById('urge_level');
    const output = document.getElementById('urge-val');
    
    slider.oninput = function() {
        output.innerHTML = this.value;
        // Visual feedback: Change color of value display if urge is high
        if(this.value >= 7) {
            output.style.background = "#ff3232";
            output.style.boxShadow = "0 0 15px #ff3232";
        } else {
            output.style.background = "#c3c908";
            output.style.boxShadow = "0 0 10px rgba(195, 201, 8, 0.5)";
        }
    }
</script>
{% endblock %}