{% extends "base.html" %}

{% block content %}
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<div class="log-page-wrapper">
    
    <div class="dashboard-header fade-in">
        <div class="header-content">
            <h6 class="overline">Journaling & Analytics</h6>
            <h1 class="glow-text">Daily Mental & Productivity Log</h1>
            <p>Track your mindset to master your discipline</p>
        </div>
        <div class="live-indicator">
            <span class="dot"></span> System Ready
        </div>
    </div>

    <div class="form-container glass fade-in-delay-1">
        <div class="card-top">
            <h3><i class="fa-solid fa-pen-nib"></i> Log for Today</h3>
            <span class="date-badge">{{ today.strftime('%b %d, %Y') }}</span>
        </div>

        <form method="POST" class="log-form-premium">
            <div class="form-grid">
                <div class="input-group">
                    <label for="mood">Current Mood</label>
                    <div class="select-wrapper">
                        <select id="mood" name="mood">
                            {% set current_mood = log.mood if log else 'Neutral' %}
                            <option value="Good" {% if current_mood == 'Good' %}selected{% endif %}>üòä Good</option>
                            <option value="Neutral" {% if current_mood == 'Neutral' %}selected{% endif %}>üòê Neutral</option>
                            <option value="Low" {% if current_mood == 'Low' %}selected{% endif %}>üòî Low</option>
                        </select>
                    </div>
                </div>

                <div class="input-group">
                    <label for="productivity">Productivity Level</label>
                    <div class="select-wrapper">
                        <select id="productivity" name="productivity">
                            {% set current_prod = log.productivity if log else 3 %}
                            {% for i in range(1, 6) %}
                                <option value="{{ i }}" {% if current_prod == i %}selected{% endif %}>
                                    Level {{ i }} - {{ {1:'Very Low', 2:'Low', 3:'Neutral', 4:'High', 5:'Very High'}[i] }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div class="input-group span-2">
                    <div class="slider-header">
                        <label for="urge_level">Urge Intensity (Relapse Risk)</label>
                        <span id="urge-val" class="value-display">{{ log.urge_level if log else '1' }}</span>
                    </div>
                    <input type="range" id="urge_level" name="urge_level" min="1" max="10" 
                           value="{{ log.urge_level if log else '1' }}" class="premium-slider">
                    <div class="slider-labels">
                        <span>Safe</span>
                        <span>Dangerous</span>
                    </div>
                </div>
            </div>

            <button type="submit" class="save-btn-premium">
                <i class="fa-solid fa-cloud-upload"></i> Sync Daily Log
            </button>
        </form>
    </div>

    <div class="history-section fade-in-delay-2">
        <h3 class="section-title"><i class="fa-solid fa-clock-rotate-left"></i> Past 14 Days Momentum</h3>
        
        {% if past_logs %}
        <div class="table-container glass">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Mood</th>
                        <th>Urge Level</th>
                        <th>Productivity</th>
                    </tr>
                </thead>
                <tbody>
                    {% for log in past_logs %}
                    <tr>
                        <td class="date-col">{{ log.date.strftime('%b %d') }}</td>
                        <td>
                            <span class="mood-tag {{ log.mood.lower() }}">{{ log.mood }}</span>
                        </td>
                        <td>
                            <div class="mini-bar-bg">
                                <div class="mini-bar-fill urge" style="width: {{ log.urge_level * 10 }}%"></div>
                            </div>
                            <span class="table-val">{{ log.urge_level }}/10</span>
                        </td>
                        <td>
                            <div class="mini-bar-bg">
                                <div class="mini-bar-fill prod" style="width: {{ log.productivity * 20 }}%"></div>
                            </div>
                            <span class="table-val">{{ log.productivity }}/5</span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="empty-state glass">
            <p>No historical data available yet. Start logging today!</p>
        </div>
        {% endif %}
    </div>
</div>



<script>
    // Real-time Slider Value Update
    const slider = document.getElementById('urge_level');
    const output = document.getElementById('urge-val');
    
    slider.oninput = function() {
        output.innerHTML = this.value;
        // Visual feedback: Change color of value display if urge is high
        if(this.value >= 7) {
            output.style.background = "#ff3232";
            output.style.boxShadow = "0 0 15px #ff3232";
        } else {
            output.style.background = "#c3c908";
            output.style.boxShadow = "0 0 10px rgba(195, 201, 8, 0.5)";
        }
    }
</script>
{% endblock %}